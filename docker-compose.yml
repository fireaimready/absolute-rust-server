# =============================================================================
# Absolute Rust Server - Docker Compose Configuration
# =============================================================================
# Production configuration for running the Rust dedicated server
# =============================================================================

services:
  rust-server:
    build:
      context: .
      dockerfile: Dockerfile
    image: absolute-rust-server:latest
    container_name: rust-server
    restart: unless-stopped

    # Ports
    ports:
      - "28015:28015/udp"   # Game port
      - "28016:28016/tcp"   # RCON port
      - "28017:28017/tcp"   # RCON Web port
      - "27015:27015/udp"   # Query port

    # Volumes
    volumes:
      - rust-server:/opt/rust/server
      - rust-config:/config

    # Environment variables - customize as needed
    environment:
      # Server Settings
      - SERVER_NAME=My Rust Server
      - SERVER_IDENTITY=rust_server
      - SERVER_SEED=
      - SERVER_WORLDSIZE=4000
      - SERVER_MAXPLAYERS=50
      - SERVER_LEVEL=Procedural Map
      - SERVER_DESCRIPTION=A Rust server running in Docker
      - SERVER_URL=
      - SERVER_HEADERIMAGE=
      - SERVER_SAVEINTERVAL=600

      # RCON Settings
      - RCON_ENABLED=true
      - RCON_PORT=28016
      - RCON_PASSWORD=changeme
      - RCON_WEB=true
      - RCON_WEB_PORT=28017

      # Modding (Oxide/uMod)
      - ENABLE_OXIDE=false
      - OXIDE_AUTO_UPDATE=true

      # Update Settings
      - UPDATE_ON_START=true
      - UPDATE_IF_IDLE=true
      - UPDATE_CRON=
      - UPDATE_TIMEOUT=1800

      # Backup Settings
      - BACKUPS_ENABLED=true
      - BACKUPS_CRON=0 */6 * * *
      - BACKUPS_MAX_AGE=7
      - BACKUPS_MAX_COUNT=0

      # System Settings
      - PUID=1000
      - PGID=1000
      - TZ=UTC

    # Health check
    healthcheck:
      test: ["CMD", "/opt/rust/scripts/healthcheck"]
      interval: 60s
      timeout: 10s
      retries: 3
      start_period: 600s

    # Resource limits (adjust based on your server)
    # deploy:
    #   resources:
    #     limits:
    #       memory: 8G
    #     reservations:
    #       memory: 4G

volumes:
  rust-server:
    name: rust-server
  rust-config:
    name: rust-config
